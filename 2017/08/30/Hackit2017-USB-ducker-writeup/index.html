<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">

<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <meta name="baidu-site-verification" content="cqIhQLk06F" />







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="CTF,misc,writeup,Forensic," />





  <link rel="alternate" href="/atom.xml" title="Chybeta" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Hackit2017-USB ducker-writeupusb keyboard pcap">
<meta property="og:type" content="article">
<meta property="og:title" content="Hackit2017-USB ducker-writeup">
<meta property="og:url" content="http://chybeta.github.io/2017/08/30/Hackit2017-USB-ducker-writeup/index.html">
<meta property="og:site_name" content="Chybeta">
<meta property="og:description" content="Hackit2017-USB ducker-writeupusb keyboard pcap">
<meta property="og:image" content="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170830/2.png?raw=true">
<meta property="og:image" content="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170830/3.png?raw=true">
<meta property="og:updated_time" content="2017-08-30T12:41:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hackit2017-USB ducker-writeup">
<meta name="twitter:description" content="Hackit2017-USB ducker-writeupusb keyboard pcap">
<meta name="twitter:image" content="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170830/2.png?raw=true">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chybeta.github.io/2017/08/30/Hackit2017-USB-ducker-writeup/"/>





  <title> Hackit2017-USB ducker-writeup | Chybeta </title>
  <meta name="baidu_union_verify" content="4dcd229ee2a964611d56cf139346dc50"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-121975637-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c9c37af8d1f8c5ce0455bd146b47dd7c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Chybeta</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-link">
          <a href="/link" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flag"></i> <br />
            
            朋友
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2017/08/30/Hackit2017-USB-ducker-writeup/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Hackit2017-USB ducker-writeup
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-30T19:22:00+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/writeup-MISC/" itemprop="url" rel="index">
                    <span itemprop="name">writeup:MISC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/08/30/Hackit2017-USB-ducker-writeup/" class="leancloud_visitors" data-flag-title="Hackit2017-USB ducker-writeup">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Hackit2017-USB ducker-writeup<br>usb keyboard pcap<br><a id="more"></a></p>
<h1 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Description: This file was captured from one of the computers at the Internet cafe. We think that the hacker was using this computer at that time. Try to get his secret documents. ( flag format is flag&#123;...&#125; )</div><div class="line">Attachment: (none)</div><div class="line">Webpage: https://mega.nz/#!NVJ1kZCR!mDxd7V0rHtMStePa-tUEHPW-SyAxQ6f1zRDCTxX8y3M</div><div class="line">Hint: (none)</div></pre></td></tr></table></figure>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>题目提供了pcap文件。</p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170830/2.png?raw=true" alt=""></p>
<p>可以知道对应的设备为apple的keyboard。</p>
<p>对于keyborad的数据传输，在数据包的<code>Leftover Capture Data</code>中，根据这篇文章：<a href="http://blog.csdn.net/luohsh1/article/details/8645471" target="_blank" rel="external"> USB鼠标、键盘数据格式 </a> 和 <a href="http://www.microchip.com/forums/m438695.aspx" target="_blank" rel="external">HID Keyboard report descriptor</a>。键盘发送给PC的数据每次8个字节，假设收到的数据为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">02:00:04:00:00:00:00:00</div></pre></td></tr></table></figure></p>
<p>第一个字节是modifier keys，对应的规则如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">|--bit0:   Left Control是否按下，按下为1  </div><div class="line">|--bit1:   Left Shift  是否按下，按下为1  </div><div class="line">|--bit2:   Left Alt    是否按下，按下为1  </div><div class="line">|--bit3:   Left GUI    是否按下，按下为1  </div><div class="line">|--bit4:   Right Control是否按下，按下为1  </div><div class="line">|--bit5:   Right Shift 是否按下，按下为1  </div><div class="line">|--bit6:   Right Alt   是否按下，按下为1  </div><div class="line">|--bit7:   Right GUI   是否按下，按下为1</div></pre></td></tr></table></figure></p>
<p>一个字节是8位，这里是<code>02</code>，即对应着<code>0000 0010</code>，即可解码为<code>Left Shift</code>，也就是说按下了键盘左边的Shift键。假若数据为<code>00</code>，则表示啥都不做。</p>
<p>第二个字节是padding，默认为<code>00</code>。可略过不提。</p>
<p>第三个字节起到第八个字节为普通按键，解码规则可以根据 <a href="http://www.usb.org/developers/hidpage/Hut1_12v2.pdf" target="_blank" rel="external">Universal Serial Bus (USB)</a>中第53页的规则来解码。</p>
<p>比如说我们收到了数据为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">04:00:00:00:00:00</div></pre></td></tr></table></figure></p>
<p>根据解码规则，以及第一字节shift被按下，可知为大写字母<code>A</code>。</p>
<p>接下去开始针对题目提供的数据包进行分析。<br>根据 <a href="https://www.wireshark.org/docs/dfref/u/usb.html" target="_blank" rel="external">https://www.wireshark.org/docs/dfref/u/usb.html</a> 可以知道 <code>Leftover Capture Data</code> 所对应的Field name为 <code>usb.capdata</code>，我们可以把值为<code>00:00:00:00:00:00:00:00</code>的数据过滤掉，因为它表示啥都不输入。</p>
<p>而我们的目标是keyboard的数据，从pcap包中看它对应的设备Device address为3，所对应的Field name为<code>usb.device_address</code>。</p>
<p>我们可以使用tshark命令提取对应的数据，并将其保存到usbdata.txt中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tshark -r task.pcap -Y &quot;usb.capdata != 0 and usb.device_address==3&quot; -T fields -e usb.capdata &gt; usbdata.txt</div></pre></td></tr></table></figure></p>
<p>提取出来的数据差不多这样：<br><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170830/3.png?raw=true" alt=""><br>(好吧，至于为什么还有00:00:00:00:00:00:00:00，哪位解释下)</p>
<p>由于还有一些零行，可以用下面命令再过滤一遍：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat usbdata.txt | grep -v &quot;00:00:00:00:00:00:00:00&quot; &gt; usbdata_filter.txt</div></pre></td></tr></table></figure></p>
<p>然后根据解码规则进行解码。脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">KEYCODE = &#123;</div><div class="line">    <span class="number">0x04</span>:[<span class="string">'a'</span>, <span class="string">'A'</span>],</div><div class="line">    <span class="number">0x05</span>:[<span class="string">'b'</span>, <span class="string">'B'</span>],</div><div class="line">    <span class="number">0x06</span>:[<span class="string">'c'</span>, <span class="string">'C'</span>],</div><div class="line">    <span class="number">0x07</span>:[<span class="string">'d'</span>, <span class="string">'D'</span>],</div><div class="line">    <span class="number">0x08</span>:[<span class="string">'e'</span>, <span class="string">'E'</span>],</div><div class="line">    <span class="number">0x09</span>:[<span class="string">'f'</span>, <span class="string">'F'</span>],</div><div class="line">    <span class="number">0x0A</span>:[<span class="string">'g'</span>, <span class="string">'G'</span>],</div><div class="line">    <span class="number">0x0B</span>:[<span class="string">'h'</span>, <span class="string">'H'</span>],</div><div class="line">    <span class="number">0x0C</span>:[<span class="string">'i'</span>, <span class="string">'I'</span>],</div><div class="line">    <span class="number">0x0D</span>:[<span class="string">'j'</span>, <span class="string">'J'</span>],</div><div class="line">    <span class="number">0x0E</span>:[<span class="string">'k'</span>, <span class="string">'K'</span>],</div><div class="line">    <span class="number">0x0F</span>:[<span class="string">'l'</span>, <span class="string">'L'</span>],</div><div class="line">    <span class="number">0x10</span>:[<span class="string">'m'</span>, <span class="string">'M'</span>],</div><div class="line">    <span class="number">0x11</span>:[<span class="string">'n'</span>, <span class="string">'N'</span>],</div><div class="line">    <span class="number">0x12</span>:[<span class="string">'o'</span>, <span class="string">'O'</span>],</div><div class="line">    <span class="number">0x13</span>:[<span class="string">'p'</span>, <span class="string">'P'</span>],</div><div class="line">    <span class="number">0x14</span>:[<span class="string">'q'</span>, <span class="string">'Q'</span>],</div><div class="line">    <span class="number">0x15</span>:[<span class="string">'r'</span>, <span class="string">'R'</span>],</div><div class="line">    <span class="number">0x16</span>:[<span class="string">'s'</span>, <span class="string">'S'</span>],</div><div class="line">    <span class="number">0x17</span>:[<span class="string">'t'</span>, <span class="string">'T'</span>],</div><div class="line">    <span class="number">0x18</span>:[<span class="string">'u'</span>, <span class="string">'U'</span>],</div><div class="line">    <span class="number">0x19</span>:[<span class="string">'v'</span>, <span class="string">'V'</span>],</div><div class="line">    <span class="number">0x1A</span>:[<span class="string">'w'</span>, <span class="string">'W'</span>],</div><div class="line">    <span class="number">0x1B</span>:[<span class="string">'x'</span>, <span class="string">'X'</span>],</div><div class="line">    <span class="number">0x1C</span>:[<span class="string">'y'</span>, <span class="string">'Y'</span>],</div><div class="line">    <span class="number">0x1D</span>:[<span class="string">'z'</span>, <span class="string">'Z'</span>],</div><div class="line">    <span class="number">0x1E</span>:[<span class="string">'1'</span>, <span class="string">'!'</span>],</div><div class="line">    <span class="number">0x1F</span>:[<span class="string">'2'</span>, <span class="string">'@'</span>],</div><div class="line">    <span class="number">0x20</span>:[<span class="string">'3'</span>, <span class="string">'#'</span>],</div><div class="line">    <span class="number">0x21</span>:[<span class="string">'4'</span>, <span class="string">'$'</span>],</div><div class="line">    <span class="number">0x22</span>:[<span class="string">'5'</span>, <span class="string">'%'</span>],</div><div class="line">    <span class="number">0x23</span>:[<span class="string">'6'</span>, <span class="string">'^'</span>],</div><div class="line">    <span class="number">0x24</span>:[<span class="string">'7'</span>, <span class="string">'&amp;'</span>],</div><div class="line">    <span class="number">0x25</span>:[<span class="string">'8'</span>, <span class="string">'*'</span>],</div><div class="line">    <span class="number">0x26</span>:[<span class="string">'9'</span>, <span class="string">'('</span>],</div><div class="line">    <span class="number">0x27</span>:[<span class="string">'0'</span>, <span class="string">')'</span>],</div><div class="line">    <span class="number">0x28</span>:[<span class="string">'\n'</span>,<span class="string">'\n'</span>],</div><div class="line">    <span class="number">0x2C</span>:[<span class="string">' '</span>, <span class="string">' '</span>],</div><div class="line">    <span class="number">0x2D</span>:[<span class="string">'-'</span>, <span class="string">'_'</span>],</div><div class="line">    <span class="number">0x2E</span>:[<span class="string">'='</span>, <span class="string">'+'</span>],</div><div class="line">    <span class="number">0x2F</span>:[<span class="string">'['</span>, <span class="string">'&#123;'</span>],</div><div class="line">    <span class="number">0x30</span>:[<span class="string">']'</span>, <span class="string">'&#125;'</span>],</div><div class="line">    <span class="number">0x32</span>:[<span class="string">'#'</span>,<span class="string">'~'</span>],</div><div class="line">    <span class="number">0x33</span>:[<span class="string">';'</span>, <span class="string">':'</span>],</div><div class="line">    <span class="number">0x34</span>:[<span class="string">'\''</span>, <span class="string">'"'</span>],</div><div class="line">    <span class="number">0x36</span>:[<span class="string">','</span>, <span class="string">'&lt;'</span>],</div><div class="line">    <span class="number">0x37</span>:[<span class="string">'.'</span>, <span class="string">'&gt;'</span>],</div><div class="line">    <span class="number">0x38</span>:[<span class="string">'/'</span>, <span class="string">'?'</span>],</div><div class="line">    <span class="number">0x2b</span>:[<span class="string">'\t'</span>,<span class="string">'\t'</span>],</div><div class="line">    <span class="number">0x4f</span>:[<span class="string">u'→'</span>,<span class="string">u'→'</span>],</div><div class="line">    <span class="number">0x50</span>:[<span class="string">u'←'</span>,<span class="string">u'←'</span>],</div><div class="line">    <span class="number">0x51</span>:[<span class="string">u'↓'</span>,<span class="string">u'↓'</span>],</div><div class="line">    <span class="number">0x52</span>:[<span class="string">u'↑'</span>,<span class="string">u'↑'</span>]</div><div class="line">&#125;</div><div class="line"></div><div class="line">NA_KEYCODE = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</div><div class="line">file = open(<span class="string">"usbdata_filter.txt"</span>,<span class="string">"rb"</span>)</div><div class="line">result = <span class="string">""</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">    data = file.readline()</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">        <span class="keyword">break</span></div><div class="line"></div><div class="line">    data = data[:<span class="number">-1</span>].split(<span class="string">":"</span>)</div><div class="line">    normalcode = int(data[<span class="number">2</span>],<span class="number">16</span>)</div><div class="line">    <span class="keyword">if</span> normalcode  <span class="keyword">in</span> NA_KEYCODE:</div><div class="line">        <span class="keyword">continue</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">'02'</span>:</div><div class="line">        shiftcode = <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        shiftcode = <span class="number">0</span></div><div class="line">    <span class="comment"># print(normalcode, shiftcode)</span></div><div class="line">    result += KEYCODE[normalcode][shiftcode]</div><div class="line">file.close()</div><div class="line">print(result)</div></pre></td></tr></table></figure></p>
<p>解出来为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">w</div><div class="line">k</div><div class="line">f</div><div class="line">b</div><div class="line">3&apos;↑[↑l↑#↑&#123;w$↓&gt;b↓ag↓[e↓ci.[↑[f↑&#123;k↑n$↑ju&#125;↓:↓3↓u↓%=↑~↑y↑6↑,&apos;↓p↓b↓7↓%&amp;↑d↑0↑j↑pt↓i↓a↓[↓k(↑=↑r↑m↑]=↓0↓d↓&gt;↓lc↑*↑_↑&#123;↑j%↓u↓s↓(↓*2↑0↑n↑&apos;↑;9↓h↓4↓]↓y4↑&apos;↑k↑;↑+p↓f↓e↓$↓!&#125;↑1↑_↑k↑s&amp;↓s↓2↓c↓%q↑$↑.↑!↑#,↓s↓0↓c↓z3↑e↑&#125;↑-↑i</div></pre></td></tr></table></figure></p>
<p>打出来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">w&#123;w$ju&#125;,&apos;pt]=j%;9+ps&amp;#,</div><div class="line">k#&gt;bn$:6pjim0&#123;u&apos;h;fks!s-</div><div class="line">flag&#123;k3yb0ard_sn4ke_2.0&#125;</div><div class="line">b[[e[fu~7d[=&gt;*(0]&apos;$1c$ce</div><div class="line">3&apos;ci.[%=%&amp;k(lc*2y4!&#125;%qz3</div></pre></td></tr></table></figure></p>

      
  </div>
    <div>
      
        <!-- Google AdSense start -->
        <!-- test3 -->
<ins class="adsbygoogle2"
     style="display:block"
     data-ad-client="ca-pub-3467872413268634"
     data-ad-slot="2179835194"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle2 = window.adsbygoogle2 || []).push({});
</script>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- test -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3467872413268634"
     data-ad-slot="5815348948"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <!-- Google AdSense end -->
      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>点击赞赏二维码，您的支持将鼓励我继续创作！</div>
    <div id="QR" style="display: block;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="https://raw.githubusercontent.com/CHYbeta/chybeta.github.io/master/images/wechat.png" alt="chybeta WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/alipay.jpg?raw=true" alt="chybeta Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>
	<div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>本文标题:</span><a href="/2017/08/30/Hackit2017-USB-ducker-writeup/">Hackit2017-USB ducker-writeup</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 chybeta 的个人博客">chybeta</a></p>
  <p><span>发布时间:</span>2017年08月30日 - 19:08</p>
  <p><span>最后更新:</span>2017年08月30日 - 20:08</p>
  <p><span>原始链接:</span><a href="/2017/08/30/Hackit2017-USB-ducker-writeup/" title="Hackit2017-USB ducker-writeup">http://chybeta.github.io/2017/08/30/Hackit2017-USB-ducker-writeup/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://chybeta.github.io/2017/08/30/Hackit2017-USB-ducker-writeup/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>
</div>
<script>
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({
          title: "",
          text: '复制成功',
          html: false,
          timer: 500,
          showConfirmButton: false
        });
      });
    }));
</script>


      
	</div>
    <div>
      
        

      
    </div>



    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
            <a href="/tags/misc/" rel="tag"># misc</a>
          
            <a href="/tags/writeup/" rel="tag"># writeup</a>
          
            <a href="/tags/Forensic/" rel="tag"># Forensic</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/29/HITB-CTF-2017-Pasty-writeup/" rel="next" title="HITB CTF 2017-Pasty-writeup">
                <i class="fa fa-chevron-left"></i> HITB CTF 2017-Pasty-writeup
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/30/Hackit2017-Cypherpunk’s-nightmare-writeup/" rel="prev" title="Hackit2017-Cypherpunk’s nightmare-writeup">
                Hackit2017-Cypherpunk’s nightmare-writeup <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      

          </div>
          


          
  <div class="comments" id="comments">
    
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTAzNC81NjAz"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="chybeta" />
          <p class="site-author-name" itemprop="name">chybeta</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">188</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">108</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/CHYbeta" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/chybeta" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://ph0en1x.com/" title="XMU-Ph0en1x" target="_blank">XMU-Ph0en1x</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.lzhtony.com/" title="lzhtony" target="_blank">lzhtony</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://findneo.github.io/" title="findneo" target="_blank">findneo</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://madsome.one/" title="Mads" target="_blank">Mads</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://ginove.github.io/" title="Ginove" target="_blank">Ginove</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://cltheorem.github.io/" title="cltheorem" target="_blank">cltheorem</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.cnblogs.com/frankscode/" title="Frank" target="_blank">Frank</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://philhe.coding.me/" title="Philhe" target="_blank">Philhe</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Task"><span class="nav-number">1.</span> <span class="nav-text">Task</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Solution"><span class="nav-number">2.</span> <span class="nav-text">Solution</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chybeta</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>
      <!-- UY END -->
  




  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("unqDDYqYUADBUogKkMVqqvFH-gzGzoHsz", "afr1xO80LoKo0xCpxHJCleC4");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  <script type='text/javascript' color='252,3,184' zIndex='-1' opacity='20' count='99' src='//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js'></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
